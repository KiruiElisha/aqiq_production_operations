[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-07-23 16:40:56.530433",
  "module": "AQIQ Production operations",
  "name": "Job Card",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Job Card",
  "script": "\ndoc.employee = ''",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-07-24 11:13:25.096818",
  "module": "AQIQ Production operations",
  "name": "Job Card Employee",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Job Card Time Log",
  "script": "doc.employee = \"\"",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-09-06 05:43:07.219081",
  "module": "AQIQ Production operations",
  "name": "Job card Custom",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Job Card",
  "script": "def create_material_request(doc):\n    if not doc.items:\n        return\n\n    # Check for existing Material Requests\n    existing_mr = frappe.db.exists(\"Material Request\", {\"job_card\": doc.name, \"docstatus\": 1})\n    if existing_mr:\n        # frappe.msgprint(f\"Material Request {existing_mr} already exists for this Job Card.\")\n        return\n\n    # Rest of your original code for creating a new Material Request\n    work_order = frappe.db.get_value(\"Work Order\", doc.name, 'name')\n\n    material_request = frappe.new_doc(\"Material Request\")\n    material_request.update({\n        \"material_request_type\": \"Material Transfer\",\n        \"company\": doc.company,\n        \"transaction_date\": doc.posting_date,\n        \"job_card\": doc.name,\n        \"work_order\": work_order\n    })\n\n    items_added = False\n    for item in doc.items:\n        if item.required_qty > 0:\n            material_request.append(\"items\", {\n                \"item_code\": item.item_code,\n                \"qty\": item.required_qty,\n                \"stock_uom\": item.stock_uom,\n                \"schedule_date\": doc.expected_start_date,\n                \"warehouse\": item.wip_warehouse, \n                \"job_card\": doc.name,\n                \"from_warehouse\": item.source_warehouse,\n                \"work_order\": work_order\n            })\n            items_added = True\n\n    if items_added:\n        material_request.insert()\n        material_request.submit()\n        frappe.msgprint(f\"Material Request {material_request.name} created and submitted.\")\n    else:\n        return\n\ncreate_material_request(doc)",
  "script_type": "DocType Event"
 }
]